#!/usr/bin/python
#Eiko Alzamora
#v1.0
#Fri Feb 24 11:53:36 PM EST 2023


import sys
import os.path
import matplotlib.pyplot as plt
import numpy as np
  

prog=sys.argv[0]
if len(sys.argv) < 1:
    print("Error: Missing Arguments.\n\t\aUsage: ",prog," text_file1 [... text_fileX]")
    exit(1)

n=len(sys.argv)

#arrX = np.ones((500,), dtype=int)
#arrY = np.ones((500,), dtype=int)
arrG = np.array( [] , dtype=np.float32 )
arrA = np.array( [] , dtype=np.float32 )
arrI = np.array( [] , dtype=np.float32 )
arrB = np.array( [] , dtype=np.float32 )

arrPtsx= np.array( [[0],   [15],[30],  [45], [60],[90],[120] ] , dtype=np.float32 )
arrPtsy= np.array( [[-0.1],[0.9],[11],[8.9], [3.4],[0.6],[-5] ] , dtype=np.float32 )
arrPtsy2= np.array( [[0],   [8],[11.2],[9.9],[8.8],[7],[9] ] , dtype=np.float32 )
arrPtsy4= np.array( [[0.4],   [2.3],[9.1],[16.7],[18.4],[13.6],[9.8] ] , dtype=np.float32 )

for i in range(n-1):
#    print(f'x = {x} n={n}')
    txtFile=sys.argv[i+1]
    arrX = np.array( [] , dtype=np.float32 )
    arrY = np.array( [] , dtype=np.float32 )
    cnt=0;
    f = open(txtFile, 'r')
    for line in f:
        cnt+=1
#        print(repr(line))
        line = line.strip()
        columns = line.split(",")
        x=float(columns[0])  - 3 ;#offset due to graph shift
        y=float(columns[1])
        fx=0
        fy=0
    
        if cnt == cnt:
            arrX = np.append( arrX , x )
            arrY = np.append( arrY , y )
#            print(f'arrX ={arrX} ')


#    print( f'y[k]={y[k]}' )
  
#    plt.plot(arrX, arrY  )
#    print(f" x = {x}")
    if i == 0:
        arrG=np.copy(arrY)  ;# Glucose
    if i == 1:
        arrA=np.copy(arrY)/10  ;# GlucAgon
    if i == 2:
        arrB=np.copy(arrY)/2 + 9  ;# Insulin

#print( f'len arrG{ arrG.shape } arrX{ arrX.shape }' )

delta_t=arrX[1]-arrX[0]
##################         ONE 
parG1=0.16
parG2=-0.04
parA1=0.19
parA2=0.06
parI1=-0.04


arrI = np.zeros( arrY.shape )
arrI[0]=0
for i in range(arrX.shape[0]-1 ) :
    arrI[i+1] = arrI[i] + delta_t * ( -arrG[i]*parG2 + arrA[i]*parA2 + arrI[i]*parI1 +
        parG1*(arrG[i+1]-arrG[i])/delta_t - parA1*(arrA[i+1]-arrA[i])/delta_t )

#plt.plot(arrX, arrA,'b')
plt.figure("one")

#plt.plot(arrX, arrG,'k',arrX, arrA,'r',arrX,arrI,'purple' ,arrX,arrB,'b'  ,arrPtsx,arrPtsy,"o",arrPtsx,arrPtsy2,"o", arrPtsx,arrPtsy4,"o",)
plt.plot(arrX, arrG,'k',arrX, arrA,'r',arrX,arrI,'purple' ,arrX,arrB,'b' )
plt.text(22,  0, 'pG1='+str(parG1) )
plt.text(22, -1, 'pG2='+str(parG2) )
plt.text(22, -2, 'pA1='+str(parA1) )
plt.text(22, -3, 'pA2='+str(parA2) )
plt.text(22, -4, 'pI1='+str(parI1) )
plt.legend(['Graph Glucose', 'Graph Glucagon','Model Insulin','Graph Insulin' ])
plt.xlabel('Time after the start of the meal (min)')
plt.ylabel('Concentration (microU/ml)')
plt.title('Blood Sugar Pathway in Anorexic Patients')
plt.grid(visible=True, which='major', axis='both')



##################         TWO

plt.figure("two")

arrI = np.zeros( arrY.shape )

#32.505028949921886 => pG1=-0.64 pG2=-0.004 pA1=0.76 pA2=0.18 pI1=-0.12000000000000002
#32.47864412383506 => pG1=-0.8 pG2=-0.04 pA1=1.3299999999999998 pA2=0.18 pI1=-0.12000000000000002
#32.453738091177186 => pG1=-0.9600000000000002 pG2=-0.004 pA1=0.76 pA2=0.18 pI1=-0.12000000000000002
#32.43299061873879 => pG1=-1.12 pG2=-0.04 pA1=0.76 pA2=0.18 pI1=-0.12000000000000002
#32.432524200565716 => pG1=-1.12 pG2=-0.04 pA1=0.475 pA2=0.18 pI1=-0.12000000000000002
#32.34945364292487 => pG1=-1.12 pG2=-0.028000000000000004 pA1=1.045 pA2=0.18 pI1=-0.12000000000000002
#32.33413515133639 => pG1=-0.32 pG2=-0.016 pA1=1.045 pA2=0.18 pI1=-0.12000000000000002
#32.319149860361584 => pG1=0.4800000000000001 pG2=-0.028000000000000004 pA1=0.475 pA2=0.06 pI1=-0.04
#32.305200801428875 => pG1=-0.8 pG2=-0.004 pA1=1.045 pA2=0.18 pI1=-0.12000000000000002
#32.28202229911629 => pG1=-0.9600000000000002 pG2=-0.016 pA1=0.19 pA2=0.18 pI1=-0.12000000000000002
#32.27984397902957 => pG1=-1.12 pG2=-0.016 pA1=0.19 pA2=0.18 pI1=-0.12000000000000002
#32.26893872492034 => pG1=-1.28 pG2=-0.028000000000000004 pA1=0.475 pA2=0.18 pI1=-0.12000000000000002
#32.216635798175645 => pG1=-0.8 pG2=-0.04 pA1=0.475 pA2=0.18 pI1=-0.12000000000000002
#32.01502802271886 => pG1=-0.64 pG2=-0.004 pA1=1.045 pA2=0.18 pI1=-0.12000000000000002
#31.95758535491473 => pG1=-0.9600000000000002 pG2=-0.028000000000000004 pA1=0.19 pA2=0.18 pI1=-0.12000000000000002
#31.925239805463455 => pG1=-0.32 pG2=-0.028000000000000004 pA1=1.045 pA2=0.18 pI1=-0.12000000000000002
#31.892794407032383 => pG1=-0.4800000000000001 pG2=-0.028000000000000004 pA1=1.6149999999999998 pA2=0.18 pI1=-0.12000000000000002
#31.882704167579398 => pG1=-0.4800000000000001 pG2=-0.04 pA1=1.3299999999999998 pA2=0.18 pI1=-0.12000000000000002
#31.851864262235345 => pG1=-1.12 pG2=-0.028000000000000004 pA1=0.19 pA2=0.18 pI1=-0.12000000000000002
#31.762918803167647 => pG1=-0.32 pG2=-0.016 pA1=1.3299999999999998 pA2=0.18 pI1=-0.12000000000000002
#31.719404694592875 => pG1=-0.8 pG2=-0.004 pA1=0.76 pA2=0.18 pI1=-0.12000000000000002
#31.705466587199318 => pG1=-0.4800000000000001 pG2=-0.04 pA1=1.045 pA2=0.18 pI1=-0.12000000000000002
#31.704861892531763 => pG1=-0.64 pG2=-0.016 pA1=0.475 pA2=0.18 pI1=-0.12000000000000002
#31.650912074499786 => pG1=-0.9600000000000002 pG2=-0.04 pA1=1.045 pA2=0.18 pI1=-0.12000000000000002
#31.56104793416492 => pG1=-0.9600000000000002 pG2=-0.04 pA1=0.475 pA2=0.18 pI1=-0.12000000000000002
#31.415743272921382 => pG1=-0.64 pG2=-0.028000000000000004 pA1=0.475 pA2=0.18 pI1=-0.12000000000000002
#31.414872229509758 => pG1=-0.64 pG2=-0.04 pA1=1.3299999999999998 pA2=0.18 pI1=-0.12000000000000002
#31.204918116435678 => pG1=-0.4800000000000001 pG2=-0.016 pA1=0.76 pA2=0.18 pI1=-0.12000000000000002
#31.176742528114886 => pG1=-0.32 pG2=-0.028000000000000004 pA1=1.3299999999999998 pA2=0.18 pI1=-0.12000000000000002
#31.144401578468432 => pG1=-0.64 pG2=-0.04 pA1=0.76 pA2=0.18 pI1=-0.12000000000000002
#30.97865938567394 => pG1=-0.8 pG2=-0.016 pA1=1.3299999999999998 pA2=0.18 pI1=-0.12000000000000002
#30.846143419591066 => pG1=-0.4800000000000001 pG2=-0.028000000000000004 pA1=0.76 pA2=0.18 pI1=-0.12000000000000002
#30.670211271815653 => pG1=-1.12 pG2=-0.016 pA1=0.76 pA2=0.18 pI1=-0.12000000000000002
#30.664830547961962 => pG1=-0.32 pG2=-0.04 pA1=-0.095 pA2=0.06 pI1=-0.04
#30.44683479077106 => pG1=-0.9600000000000002 pG2=-0.04 pA1=0.76 pA2=0.18 pI1=-0.12000000000000002
#30.321524553285062 => pG1=-1.12 pG2=-0.016 pA1=0.475 pA2=0.18 pI1=-0.12000000000000002
#30.1082003993926 => pG1=-0.64 pG2=-0.04 pA1=1.045 pA2=0.18 pI1=-0.12000000000000002
#30.089061232202276 => pG1=-0.8 pG2=-0.04 pA1=1.045 pA2=0.18 pI1=-0.12000000000000002
#30.049417567091346 => pG1=-0.8 pG2=-0.028000000000000004 pA1=1.3299999999999998 pA2=0.18 pI1=-0.12000000000000002
#29.99502245115137 => pG1=-0.8 pG2=-0.04 pA1=0.76 pA2=0.18 pI1=-0.12000000000000002
#29.976144369222347 => pG1=-0.9600000000000002 pG2=-0.016 pA1=1.045 pA2=0.18 pI1=-0.12000000000000002
#29.91488534060737 => pG1=-0.4800000000000001 pG2=-0.016 pA1=1.3299999999999998 pA2=0.18 pI1=-0.12000000000000002
#29.866001328596965 => pG1=-1.12 pG2=-0.028000000000000004 pA1=0.76 pA2=0.18 pI1=-0.12000000000000002
#29.68719259244848 => pG1=-1.12 pG2=-0.028000000000000004 pA1=0.475 pA2=0.18 pI1=-0.12000000000000002
#29.64821030114469 => pG1=-0.8 pG2=-0.016 pA1=0.475 pA2=0.18 pI1=-0.12000000000000002
#29.639474923723153 => pG1=-0.64 pG2=-0.016 pA1=1.3299999999999998 pA2=0.18 pI1=-0.12000000000000002
#29.36653533614224 => pG1=-0.4800000000000001 pG2=-0.016 pA1=1.045 pA2=0.18 pI1=-0.12000000000000002
#29.226044267054906 => pG1=-0.8 pG2=-0.028000000000000004 pA1=0.475 pA2=0.18 pI1=-0.12000000000000002
#29.178780995490346 => pG1=-0.4800000000000001 pG2=-0.028000000000000004 pA1=1.3299999999999998 pA2=0.18 pI1=-0.12000000000000002
#29.161879830774936 => pG1=-0.9600000000000002 pG2=-0.016 pA1=0.475 pA2=0.18 pI1=-0.12000000000000002
#29.083885548346924 => pG1=-0.9600000000000002 pG2=-0.028000000000000004 pA1=1.045 pA2=0.18 pI1=-0.12000000000000002
#28.997920926910684 => pG1=0.4800000000000001 pG2=-0.04 pA1=0.76 pA2=0.06 pI1=-0.04
#28.801261603855185 => pG1=-0.4800000000000001 pG2=-0.028000000000000004 pA1=1.045 pA2=0.18 pI1=-0.12000000000000002
#28.781834563982756 => pG1=-0.64 pG2=-0.028000000000000004 pA1=1.3299999999999998 pA2=0.18 pI1=-0.12000000000000002
#28.62000207378836 => pG1=-0.64 pG2=-0.016 pA1=0.76 pA2=0.18 pI1=-0.12000000000000002
#28.61739255028064 => pG1=-0.9600000000000002 pG2=-0.028000000000000004 pA1=0.475 pA2=0.18 pI1=-0.12000000000000002
#28.42521146872079 => pG1=0.32 pG2=-0.04 pA1=0.76 pA2=0.06 pI1=-0.04
#28.32952507730803 => pG1=-0.9600000000000002 pG2=-0.016 pA1=0.76 pA2=0.18 pI1=-0.12000000000000002
#28.111150805072533 => pG1=-0.64 pG2=-0.028000000000000004 pA1=0.76 pA2=0.18 pI1=-0.12000000000000002
#28.087895351533103 => pG1=-0.8 pG2=-0.016 pA1=1.045 pA2=0.18 pI1=-0.12000000000000002
#27.978776634972196 => pG1=-0.32 pG2=-0.028000000000000004 pA1=-0.095 pA2=0.06 pI1=-0.04
#27.872410266788055 => pG1=-0.64 pG2=-0.016 pA1=1.045 pA2=0.18 pI1=-0.12000000000000002
#27.60512411711106 => pG1=-0.8 pG2=-0.016 pA1=0.76 pA2=0.18 pI1=-0.12000000000000002
#27.576865944744707 => pG1=-0.9600000000000002 pG2=-0.028000000000000004 pA1=0.76 pA2=0.18 pI1=-0.12000000000000002
#27.57668495233535 => pG1=-0.16 pG2=-0.028000000000000004 pA1=0.19 pA2=0.06 pI1=-0.04
#27.319920739582912 => pG1=0.16 pG2=-0.028000000000000004 pA1=0.475 pA2=0.06 pI1=-0.04
#27.255061932606225 => pG1=-0.8 pG2=-0.028000000000000004 pA1=1.045 pA2=0.18 pI1=-0.12000000000000002
#27.154836734517865 => pG1=-0.64 pG2=-0.028000000000000004 pA1=1.045 pA2=0.18 pI1=-0.12000000000000002
#27.114473686651415 => pG1=0.32 pG2=-0.028000000000000004 pA1=0.475 pA2=0.06 pI1=-0.04
#26.99169805938449 => pG1=0.16 pG2=-0.04 pA1=-0.095 pA2=0.06 pI1=-0.04
#26.954958543398757 => pG1=-0.8 pG2=-0.028000000000000004 pA1=0.76 pA2=0.18 pI1=-0.12000000000000002
#26.531418862875352 => pG1=-0.0 pG2=-0.04 pA1=0.475 pA2=0.06 pI1=-0.04
#26.44043064750771 => pG1=0.4800000000000001 pG2=-0.04 pA1=0.475 pA2=0.06 pI1=-0.04
#25.537282332974925 => pG1=-0.16 pG2=-0.04 pA1=0.19 pA2=0.06 pI1=-0.04
#24.968845949385273 => pG1=0.32 pG2=-0.028000000000000004 pA1=0.19 pA2=0.06 pI1=-0.04
#23.435492870738383 => pG1=-0.16 pG2=-0.04 pA1=-0.095 pA2=0.06 pI1=-0.04
#23.320652815157718 => pG1=0.32 pG2=-0.04 pA1=0.19 pA2=0.06 pI1=-0.04
#23.287368462240835 => pG1=0.16 pG2=-0.028000000000000004 pA1=-0.095 pA2=0.06 pI1=-0.04
#21.877590588522704 => pG1=-0.0 pG2=-0.04 pA1=-0.095 pA2=0.06 pI1=-0.04
#19.856501227966493 => pG1=-0.0 pG2=-0.028000000000000004 pA1=0.19 pA2=0.06 pI1=-0.04
#19.548034538535717 => pG1=-0.16 pG2=-0.028000000000000004 pA1=-0.095 pA2=0.06 pI1=-0.04
#19.539535099077014 => pG1=0.16 pG2=-0.04 pA1=0.475 pA2=0.06 pI1=-0.04
#19.498380117439904 => pG1=0.32 pG2=-0.04 pA1=0.475 pA2=0.06 pI1=-0.04
#18.670936756828638 => pG1=0.16 pG2=-0.028000000000000004 pA1=0.19 pA2=0.06 pI1=-0.04
#17.376867294057476 => pG1=-0.0 pG2=-0.028000000000000004 pA1=-0.095 pA2=0.06 pI1=-0.04
#17.1911796639742 => pG1=-0.0 pG2=-0.04 pA1=0.19 pA2=0.06 pI1=-0.04
#16.107038145773203 => pG1=0.16 pG2=-0.04 pA1=0.19 pA2=0.06 pI1=-0.04
#

#parG1=0.16
parG1=0.16
parG2=-0.04
#parA1=0.19
parA1=0.095
parA2=0.06
parI1=-0.04


arrI[0]=0

for i in range(arrX.shape[0]-1 ) :
    arrI[i+1] = arrI[i] + delta_t * ( -arrG[i]*parG2 + arrA[i]*parA2 + arrI[i]*parI1 +
        parG1*(arrG[i+1]-arrG[i])/delta_t - parA1*(arrA[i+1]-arrA[i])/delta_t )


plt.plot(arrX, arrG,'k',arrX, arrA,'r',arrX,arrI,'purple' ,arrX,arrB,'b' )
#plt.plot(arrX, arrG,'k',arrX, arrA,'r',arrX,arrI,'purple' ,arrX,arrB,'b'  ,arrPtsx,arrPtsy,"o",arrPtsx,arrPtsy2,"o", arrPtsx,arrPtsy4,"o",)
plt.text(22,  0, 'pG1='+str(parG1) )
plt.text(22, -1, 'pG2='+str(parG2) )
plt.text(22, -2, 'pA1='+str(parA1) )
plt.text(22, -3, 'pA2='+str(parA2) )
plt.text(22, -4, 'pI1='+str(parI1) )
plt.legend(['Graph Glucose', 'Graph Glucagon','Model Insulin','Graph Insulin' ])
plt.xlabel('Time after the start of the meal (min)')
plt.ylabel('Change in Concentration from Baseline')
plt.title('Blood Sugar Pathway in Anorexic Patients')
plt.grid(visible=True, which='major', axis='both')



plt.show()
